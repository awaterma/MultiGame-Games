<?xml version="1.0" encoding="utf-8"?>
<mx:VBox
        xmlns:mx="http://www.adobe.com/2006/mxml"
        xmlns:component="mx.ecosur.multigame.component.*"
        xmlns:pasale="mx.ecosur.multigame.pasale.*"
        width="100%" height="100%"
        creationComplete="{init()}">

    <mx:Metadata>
        [Event(name="complete")]
    </mx:Metadata>

    <mx:Script>
        <![CDATA[
        import mx.collections.ArrayCollection;
        import mx.ecosur.multigame.entity.GamePlayer;
        import mx.ecosur.multigame.pasale.entity.PasaleGame;
        import mx.ecosur.multigame.pasale.entity.PasaleGrid;
        import mx.events.MenuEvent;
        import mx.managers.CursorManager;

        [Bindable]
        private var _currentPlayer:GamePlayer;

        [Bindable]
        private var _currentGame:PasaleGame;

        [Bindable]
        private var _controller:PasaleGameController;

        [Bindable]
        private var _grid:PasaleGrid;

        [Bindable]
        private var _players:ArrayCollection;

        public function init():void {
            CursorManager.removeBusyCursor();
            _controller = new PasaleGameController(this);
        }

        public function get currentPlayer():GamePlayer {
            return _currentPlayer;
        }

        public function set currentPlayer(value:GamePlayer):void {
            _currentPlayer = value;
        }

        public function get currentGame():PasaleGame {
            return _currentGame;
        }

        public function set currentGame(value:PasaleGame):void {
            _currentGame = value;
            _grid = PasaleGrid (_currentGame.grid);
            _players = _currentGame.players;
        }

        public function destroy():void {
            _controller.destroy();
        }

        public function dispatchCompletion():void {
            this.dispatchEvent(new Event("complete"));
        }

        public function quitGame():void {
            _controller.quitGame(currentPlayer);
        }

        private function handleMenuItemClick(evt:MenuEvent):void {
            if (evt.label == 'Lobby')
                dispatchCompletion();
            else if (evt.label == 'Quit') {
                quitGame();
                dispatchCompletion();
            }
        }

        public function get controller():PasaleGameController {
            if (_controller == null)
                _controller = new PasaleGameController(this);
            return _controller;
        }

        public function set controller(value:PasaleGameController):void {
            _controller = value;
        }

     ]]>
    </mx:Script>

    <mx:XMLList id="menuXML">
        <menuitem label="Game">
            <menuitem label="Lobby"/>
            <menuitem label="Quit"/>
        </menuitem>
    </mx:XMLList>

    <mx:ApplicationControlBar id="controlBar" dock="true" width="100%">
        <mx:MenuBar height="100%"
            dataProvider="{menuXML}"
            labelField="@label"
            showRoot="true"
            itemClick="handleMenuItemClick(event)"/>
    </mx:ApplicationControlBar>
    <pasale:ScoreBoard id="scoreboard" players="{_players}" creationComplete="{scoreboard.draw()}"
            height="20" width="{board.width}"/>    
    <mx:VBox width="100%" height="100%" paddingTop="10" paddingBottom="10"
             paddingLeft="10" paddingRight="10" id="hbox">
        <pasale:PasaleBoard id="board" width="100%" height="100%" controller="{_controller}"
            grid="{_grid}" currentPlayer="{_currentPlayer}"/>
    </mx:VBox>
    <mx:UIComponent id="animateLayer"/>
</mx:VBox>
